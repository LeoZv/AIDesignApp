import{f as ze}from"./DYy46uBp.js";import{d as _e,f as me,c as ve,X as ge,V as Ee,o as W,l as Y,F as Se,J as we,G as Le,Y as ne,u as le}from"./CK7kk10P.js";/**
 * Encodes an RGBA image to a PNG data URI. RGB should not be premultiplied by A.
 *
 * @remarks
 * This is optimized for speed and simplicity and does not optimize for size
 * at all. This doesn't do any compression (all values are stored uncompressed).
 *
 * @see https://github.com/evanw/thumbhash
 * @author Evan Wallace
 * @license MIT
 */function ie(e,t,r){const s=e*4+1,l=6+t*(5+s),o=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,e>>8,e&255,0,0,t>>8,t&255,8,6,0,0,0,0,0,0,0,l>>>24,l>>16&255,l>>8&255,l&255,73,68,65,84,120,1],d=[0,498536548,997073096,651767980,1994146192,1802195444,1303535960,1342533948,-306674912,-267414716,-690576408,-882789492,-1687895376,-2032938284,-1609899400,-1111625188];let a=1,n=0;for(let c=0,f=0,i=s-1;c<t;c++,i+=s-1)for(o.push(c+1<t?0:1,s&255,s>>8,~s&255,s>>8^255,0),n=(n+a)%65521;f<i;f++){const h=r[f]&255;o.push(h),a=(a+h)%65521,n=(n+a)%65521}o.push(n>>8,n&255,a>>8,a&255,0,0,0,0,0,0,0,0,73,69,78,68,174,66,96,130);for(let[c,f]of[[12,29],[37,41+l]]){let i=-1;for(let h=c;h<f;h++)i^=o[h],i=i>>>4^d[i&15],i=i>>>4^d[i&15];i=~i,o[f++]=i>>>24,o[f++]=i>>16&255,o[f++]=i>>8&255,o[f++]=i&255}return`data:image/png;base64,${globalThis.btoa(String.fromCharCode(...o))}`}const te=32,Ce="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",ue=typeof window>"u",Be=!ue&&"loading"in HTMLImageElement.prototype,Ge=!ue&&(!("onscroll"in window)||/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent));function de(e,t=document){return typeof e=="string"?[...t.querySelectorAll(e)]:e instanceof Element?[e]:[...e]}function Pe(e,t){let r,s;return e>=1?(r=t,s=Math.round(t/e)):(r=Math.round(t*e),s=t),{width:r,height:s}}function Te(e,t){let r;return function(...s){r&&clearTimeout(r),r=setTimeout(()=>{r=void 0,e(...s)},t)}}const Re="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",Z=(e,t,r)=>{let s=0;for(;t<r;)s*=83,s+=Re.indexOf(e[t++]);return s},fe=Math.pow,I=Math.PI,Ue=I*2,he=3294.6,pe=269.025,Ne=e=>e>10.31475?fe(e/pe+.052132,2.4):e/he,Q=e=>~~(e>1227e-8?pe*fe(e,.416666)-13.025:e*he+1),N=e=>(e<0?-1:1)*e*e,ce=e=>{for(e+=I/2;e>I;)e-=Ue;const t=1.27323954*e-.405284735*N(e);return .225*(N(t)-t)+t};function Ie(e){const t=Z(e,2,6);return[t>>16,t>>8&255,t&255]}function Oe(e,t,r,s){const l=Z(e,0,1),o=l%9+1,d=~~(l/9)+1,a=o*d;let n=0,p=0,c=0,f=0,i=0,h=0,v=0,g=0,C=0,b=0,E=0,O=0,H=0,S=0;const m=(Z(e,1,2)+1)/13446*(s|1),z=new Float64Array(a*3),J=Ie(e);for(n=0;n<3;n++)z[n]=Ne(J[n]);for(n=1;n<a;n++)S=Z(e,4+n*2,6+n*2),z[n*3]=N(~~(S/(19*19))-9)*m,z[n*3+1]=N(~~(S/19)%19-9)*m,z[n*3+2]=N(S%19-9)*m;const k=t*4,w=new Uint8ClampedArray(k*r);for(f=0;f<r;f++)for(O=I*f/r,c=0;c<t;c++){for(i=0,h=0,v=0,H=I*c/t,p=0;p<d;p++)for(C=ce(O*p),n=0;n<o;n++)g=ce(H*n)*C,b=(n+p*o)*3,i+=z[b]*g,h+=z[b+1]*g,v+=z[b+2]*g;E=4*c+f*k,w[E]=Q(i),w[E+1]=Q(h),w[E+2]=Q(v),w[E+3]=255}return w}function He(e,{ratio:t=1,size:r=te}={}){const{width:s,height:l}=Pe(t,r),o=Oe(e,s,l);return ie(s,l,o)}function ke(e){let{PI:t,min:r,max:s,cos:l,round:o}=Math,d=e[0]|e[1]<<8|e[2]<<16,a=e[3]|e[4]<<8,n=(d&63)/63,p=(d>>6&63)/31.5-1,c=(d>>12&63)/31.5-1,f=(d>>18&31)/31,i=d>>23,h=(a>>3&63)/63,v=(a>>9&63)/63,g=a>>15,C=s(3,g?i?5:7:a&7),b=s(3,g?a&7:i?5:7),E=i?(e[5]&15)/15:1,O=(e[5]>>4)/15,H=i?6:5,S=0,m=(T,_,R)=>{let B=[];for(let L=0;L<_;L++)for(let G=L?0:1;G*_<T*(_-L);G++)B.push(((e[H+(S>>1)]>>((S++&1)<<2)&15)/7.5-1)*R);return B},z=m(C,b,f),J=m(3,3,h*1.25),k=m(3,3,v*1.25),w=i&&m(5,5,O),x=xe(e),M=o(x>1?32:32*x),D=o(x>1?32/x:32),P=new Uint8Array(M*D*4),q=[],F=[];for(let T=0,_=0;T<D;T++)for(let R=0;R<M;R++,_+=4){let B=n,L=p,G=c,re=E;for(let u=0,A=s(C,i?5:3);u<A;u++)q[u]=l(t/M*(R+.5)*u);for(let u=0,A=s(b,i?5:3);u<A;u++)F[u]=l(t/D*(T+.5)*u);for(let u=0,A=0;u<b;u++)for(let y=u?0:1,U=F[u]*2;y*b<C*(b-u);y++,A++)B+=z[A]*q[y]*U;for(let u=0,A=0;u<3;u++)for(let y=u?0:1,U=F[u]*2;y<3-u;y++,A++){let oe=q[y]*U;L+=J[A]*oe,G+=k[A]*oe}if(i)for(let u=0,A=0;u<5;u++)for(let y=u?0:1,U=F[u]*2;y<5-u;y++,A++)re+=w[A]*q[y]*U;let se=B-2/3*L,ae=(3*B-se+G)/2,be=ae-G;P[_]=s(0,255*r(1,ae)),P[_+1]=s(0,255*r(1,be)),P[_+2]=s(0,255*r(1,se)),P[_+3]=s(0,255*r(1,re))}return{w:M,h:D,rgba:P}}function xe(e){let t=e[3],r=e[2]&128,s=e[4]&128,l=s?r?5:7:t&7,o=s?t&7:r?5:7;return l/o}function Me(e){const t=De(e),{w:r,h:s,rgba:l}=ke(t);return ie(r,s,l)}function De(e){return Uint8Array.from(globalThis.atob(qe(e)),t=>t.charCodeAt(0))}function qe(e){return e.replaceAll("-","+").replaceAll("_","/")}function Fe(e='img[loading="lazy"]',{hash:t=!0,hashType:r="blurhash",placeholderSize:s=te,updateSizesOnResize:l=!1,onImageLoad:o}={}){const d=new Set;for(const a of de(e)){const n=j(a,{updateOnResize:l});if(l&&n&&d.add(n),t){const c=ee({image:a,hash:typeof t=="string"?t:void 0,hashType:r,size:s});c&&(a.src=c)}if(!a.dataset.src&&!a.dataset.srcset){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error("[unlazy] Missing `data-src` or `data-srcset` attribute",a);continue}if(Ge||!Be){Ae(a),X(a),V(a);continue}if(a.src||(a.src=Ce),a.complete&&a.naturalWidth>0){K(a,o);continue}const p=()=>K(a,o);a.addEventListener("load",p,{once:!0}),d.add(()=>a.removeEventListener("load",p))}return()=>{for(const a of d)a();d.clear()}}function We(e='img[data-sizes="auto"], source[data-sizes="auto"]'){for(const t of de(e))j(t)}function K(e,t){var a;if(((a=e.parentElement)==null?void 0:a.tagName.toLowerCase())==="picture"){Ae(e),X(e),V(e),t==null||t(e);return}const s=new Image,{srcset:l,src:o,sizes:d}=e.dataset;if(d==="auto"){const n=ye(e);n&&(s.sizes=`${n}px`)}else e.sizes&&(s.sizes=e.sizes);l&&(s.srcset=l),o&&(s.src=o),s.addEventListener("load",()=>{X(e),V(e),t==null||t(e)},{once:!0})}function ee({image:e,hash:t,hashType:r="blurhash",size:s=te,ratio:l}={}){if(!t&&e){const{blurhash:o,thumbhash:d}=e.dataset;t=d||o,r=d?"thumbhash":"blurhash"}if(t)try{if(r==="thumbhash")return Me(t);if(!l&&e){const o=e.width||e.offsetWidth||s,d=e.height||e.offsetHeight||s;l=o/d}return He(t,{ratio:l,size:s})}catch(o){(typeof __UNLAZY_LOGGING__>"u"||__UNLAZY_LOGGING__)&&console.error(`Error generating ${r} placeholder:`,o)}}const $=new WeakMap;function j(e,t){var s;if(e.dataset.sizes!=="auto")return;const r=ye(e);if(r&&(e.sizes=`${r}px`),((s=e.parentElement)==null?void 0:s.tagName.toLowerCase())==="picture"&&!(t!=null&&t.skipChildren)&&[...e.parentElement.getElementsByTagName("source")].forEach(l=>j(l,{skipChildren:!0})),t!=null&&t.updateOnResize){if(!$.has(e)){const l=Te(()=>j(e),500),o=new ResizeObserver(l);$.set(e,o),o.observe(e)}return()=>{const l=$.get(e);l&&(l.disconnect(),$.delete(e))}}}function V(e){e.dataset.src&&(e.src=e.dataset.src,e.removeAttribute("data-src"))}function X(e){e.dataset.srcset&&(e.srcset=e.dataset.srcset,e.removeAttribute("data-srcset"))}function Ae(e){const t=e.parentElement;(t==null?void 0:t.tagName.toLowerCase())==="picture"&&([...t.querySelectorAll("source[data-srcset]")].forEach(X),[...t.querySelectorAll("source[data-src]")].forEach(V))}function ye(e){var t,r;return e instanceof HTMLSourceElement?(r=(t=e.parentElement)==null?void 0:t.getElementsByTagName("img")[0])==null?void 0:r.offsetWidth:e.offsetWidth}const Ye={key:0},$e=["type","data-srcset","data-sizes"],Ze=["src","data-src","data-srcset","data-sizes"],je=["src","data-src","data-srcset","data-sizes"],Je=_e({inheritAttrs:!1,__name:"UnLazyImage",props:{src:{default:void 0},srcSet:{default:void 0},sources:{default:void 0},autoSizes:{type:Boolean,default:!1},blurhash:{default:void 0},thumbhash:{default:void 0},placeholderSrc:{default:void 0},placeholderSize:{default:void 0},placeholderRatio:{default:void 0},lazyLoad:{type:Boolean,default:!0},preload:{type:Boolean,default:!1},ssr:{type:Boolean,default:void 0}},emits:["loaded","error"],setup(e,{emit:t}){const r=e,s=t,l=ze().public.unlazy,o=me(()=>r.thumbhash||r.blurhash),d=(r.ssr??l.ssr)&&o.value?ee({hash:o.value,hashType:r.thumbhash?"thumbhash":"blurhash",size:r.placeholderSize||l.placeholderSize,ratio:r.placeholderRatio}):void 0,a=ve();let n,p;return ge(()=>{if(n==null||n(),!!a.value){if(o.value&&o.value!==p){const c=ee({image:a.value,hash:o.value,hashType:r.thumbhash?"thumbhash":"blurhash",size:r.placeholderSize||l.placeholderSize,ratio:r.placeholderRatio});c&&(a.value.src=c),p=o.value}if(r.preload){r.autoSizes&&We(a.value),K(a.value),s("loaded",a.value);return}r.lazyLoad&&(n=Fe(a.value,{hash:!1,onImageLoad(c){s("loaded",c)}}))}}),Ee(()=>{n==null||n()}),(c,f)=>{var i;return(i=r.sources)!=null&&i.length?(W(),Y("picture",Ye,[(W(!0),Y(Se,null,we(r.sources,(h,v)=>(W(),Y("source",{key:v,type:h.type,"data-srcset":h.srcSet,"data-sizes":h.sizes},null,8,$e))),128)),Le("img",ne({ref_key:"target",ref:a},c.$attrs,{src:le(d)||c.placeholderSrc,"data-src":c.src,"data-srcset":c.srcSet,"data-sizes":c.autoSizes?"auto":void 0,loading:"lazy",onError:f[0]||(f[0]=h=>s("error",h))}),null,16,Ze)])):(W(),Y("img",ne({key:1,ref_key:"target",ref:a},c.$attrs,{src:le(d)||c.placeholderSrc,"data-src":c.src,"data-srcset":c.srcSet,"data-sizes":c.autoSizes?"auto":void 0,loading:"lazy",onError:f[1]||(f[1]=h=>s("error",h))}),null,16,je))}}});export{Je as _};
